%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#8b5cf6', 'primaryTextColor': '#fff', 'primaryBorderColor': '#7c3aed', 'lineColor': '#F8B229', 'secondaryColor': '#006100', 'tertiaryColor': '#fff'}}}%%
flowchart TB
    subgraph FRONTEND["ğŸ–¥ï¸ FRONTEND (Vercel)"]
        direction TB
        DASH["ğŸ“Š /dashboard-pa?tab=mio<br/>DashboardPA.tsx"]
        MIHUB["ğŸ›ï¸ /mihub<br/>MIHUBDashboard.tsx"]
        HOOK["ğŸª useAgentLogs.ts"]
    end

    subgraph VERCEL_API["â˜ï¸ VERCEL API (Tubo Diretto)"]
        direction TB
        GET_MSG["ğŸ“¥ /api/mihub/get-messages"]
    end

    subgraph HETZNER["ğŸ–¥ï¸ BACKEND HETZNER"]
        direction TB
        ORCH["ğŸ¯ /api/mihub/orchestrator"]
        TRPC["ğŸ”— TRPC Router"]
    end

    subgraph DATABASE["ğŸ—„ï¸ DATABASE"]
        direction TB
        DB[(PostgreSQL<br/>messages table)]
    end

    %% Flussi LETTURA
    DASH -->|"âœ… useAgentLogs"| HOOK
    HOOK -->|"âœ… fetch()"| GET_MSG
    GET_MSG -->|"âœ… SQL Query"| DB

    MIHUB -->|"âŒ TRPC (ATTUALE)"| TRPC
    TRPC -->|"âŒ 404 Error"| DB
    
    MIHUB -.->|"âœ… fetch() (TARGET)"| GET_MSG

    %% Flussi SCRITTURA
    DASH -->|"âœ… callOrchestrator()"| ORCH
    MIHUB -->|"âœ… handleSendMessage()"| ORCH
    ORCH -->|"âœ… INSERT"| DB

    %% Stili
    classDef working fill:#10b981,stroke:#059669,color:#fff
    classDef broken fill:#ef4444,stroke:#dc2626,color:#fff
    classDef target fill:#8b5cf6,stroke:#7c3aed,color:#fff
    
    class DASH,HOOK,GET_MSG,ORCH working
    class TRPC broken
    class MIHUB target
