%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#3b82f6', 'primaryTextColor': '#fff', 'primaryBorderColor': '#1e40af', 'lineColor': '#64748b', 'secondaryColor': '#10b981', 'tertiaryColor': '#f59e0b'}}}%%

flowchart TD
    subgraph APP_PUBBLICA["ğŸ“± App Pubblica MioHub"]
        A[ğŸ  HomePage<br/>Barra Ricerca] -->|"Digita 'calzature'"| B[ğŸ” API Search<br/>api.mio-hub.me/api/public/search]
        B -->|Risultati| C{Tipo Risultato?}
        
        C -->|impresa/negozio| D[ğŸ“‹ VetrinePage<br/>/vetrine/:id]
        C -->|mercato| E[ğŸ—ºï¸ MapPage<br/>/mappa]
        C -->|hub| D
        
        D -->|"Tab 'Come Arrivare'"| F[ğŸ§­ RoutePage<br/>/route]
        
        F -->|Auto-GPS| G[ğŸ“ Geolocalizzazione<br/>Automatica]
        G -->|Permesso OK| H[âœ… Coordinate<br/>Auto-compilate]
        G -->|Permesso NO| I[âš ï¸ Richiesta<br/>Manuale]
        
        H --> J[ğŸ”¢ Calcola Percorso<br/>API Routing]
        I --> J
        
        J -->|Risposta| K[ğŸ—ºï¸ Mappa GIS<br/>con Route]
        
        K -->|"Avvia Navigazione"| L{ğŸ“± Piattaforma?}
        
        L -->|iOS| M[ğŸ Apple Maps]
        L -->|Android| N[ğŸ¤– Google Maps]
        L -->|Desktop| O[ğŸŒ Google Maps Web]
    end
    
    subgraph BACKEND["âš™ï¸ Backend API"]
        B2[GET /api/public/search]
        B3[POST /api/routing/calculate]
        B4[GET /api/hub/shops]
        B5[GET /api/markets/:id/stalls]
    end
    
    B -.-> B2
    J -.-> B3
    D -.->|"Recupera coordinate"| B4
    D -.->|"Fallback posteggio"| B5
    
    style A fill:#3b82f6,stroke:#1e40af,color:#fff
    style D fill:#10b981,stroke:#059669,color:#fff
    style F fill:#f59e0b,stroke:#d97706,color:#fff
    style K fill:#8b5cf6,stroke:#7c3aed,color:#fff
    style M fill:#000,stroke:#333,color:#fff
    style N fill:#34a853,stroke:#1e8e3e,color:#fff
